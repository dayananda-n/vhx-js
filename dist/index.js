!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o(require("superagent")):"function"==typeof define&&define.amd?define(["superagent"],o):t.VhxApi=o(t.request)}(this,function(t){"use strict";function o(t){return r(t)&&t.method?t.method:t}function e(t){return isNaN(parseInt(t,10))}function r(t){var o=typeof t;return"function"===o||"object"===o&&!!t}function n(t){return!!(t&&t.constructor&&t.call&&t.apply)}function i(t,o,e){return"products"===o.path?p(t,o):"videos"===o.path?c(t,o,e):"collections"===o.path?c(t,o,e):"customers"===o.path?c(t,o,e):s(o)}t="default"in t?t.default:t;var a={HOST:"api.vhx.tv",PROTOCOL:"https://",TIMEOUT:"30000"},c=function(t,o,r){return r&&r.scope?e(t)?t+"/"+r.scope:""+o._api.protocol+o._api.host+"/"+o.path+"/"+t+"/"+r.scope:e(t)&&!n(t)?t:n(t)?s(o):""+o._api.protocol+o._api.host+"/"+o.path+"/"+t},s=function(t){return""+t._api.protocol+t._api.host+"/"+t.path},p=function(t,o){return e(t)&&!n(t)?t:n(t)?s(o):""+o._api.protocol+o._api.host+"/"+o.path+"/"+t},u=function(t,o,e,r){this._api=t,this.methods=e,this.path=o,this.init()};u.prototype.init=function(){var t=this;this.methods.forEach(function(e){var r=o(e),a={http_method:"get",client_method:r};r.match(/files|items|watching|watchlist/)&&(a.scope=e),t[r]=function(o,e){a.url=i(o,t,a),n(o)?a.callback=o:a.callback=e,t.createRequestParams(a)}})},u.prototype.getParams=function(t,o,e,n,i){var a={timeout:this._api.timeout,method:t,url:o};return r(e)&&(a.qs=e||null),this._api.auth&&(a.headers={Authorization:this._api.auth}),this._api.internal&&(a.headers={Authorization:"Bearer "+this._api.token}),a},u.prototype.createRequestParams=function(t){var o=this.getParams(t.client_method,t.url,t.options,t.scope,t.read_only);n(t.options)&&(t.callback=t.options),this.ajaxRequest(t,o)},u.prototype.ajaxRequest=function(o,e){var r=this;t[o.http_method](e.url).withCredentials().set(e.headers||{}).set("Content-Type","application/json").query(e.qs).end(function(t,e){t?r.errorHandler({status:e.statusCode,body:JSON.stringify({message:t,documentation_url:"http://dev.vhx.tv/docs/api"}),callback:o.callback||""}):r.successHandler({body:e.body||null,callback:o.callback,options:o.options,object:r.path,method:o.client_method})})},u.prototype.successHandler=function(t){var o=t.body;o.object=t.object,t.callback&&t.callback(!1,o)},u.prototype.errorHandler=function(t){var o=JSON.parse(t.body),e={400:"VHXInvalidRequestError",401:"VHXAuthenticationError",404:"VHXResourceNotFound",408:"VHXConnectionError",500:"VHXAPIError"};o.status=t.status,o.type=e[o.status],t.callback&&t.callback(o,null)};var l=function(t){function o(o){t.call(this,o,"collections",["all","retrieve","items"])}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o}(u),h=function(t){function o(o){t.call(this,o,"videos",["all","retrieve","files"])}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o}(u),f=function(t){function o(o){t.call(this,o,"customers",["retrieve","all","watching","watchlist"])}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o}(u),d=function(t){function o(o){t.call(this,o,"browse",["list"])}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o}(u),_={products:function(t){function o(o){t.call(this,o,"products",["retrieve","all"])}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o}(u),browse:d,videos:h,collections:l,customers:f,analytics:function(t){function o(o){t.call(this,o,"analytics",["retrieve"])}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o}(u)};"undefined"==typeof btoa&&(global.btoa=function(t){return new Buffer(t).toString("base64")});var y=function(t,o){void 0===o&&(o={}),this.api=o.internal?this.setToken(t,o):this.setApi(t,o),this.prepareResources()};return y.prototype.setApi=function(t,o){return void 0===o&&(o={}),{auth:"Basic "+btoa(t),host:o.host||a.HOST,protocol:o.protocol||a.PROTOCOL,timeout:a.TIMEOUT,token_expiration:null}},y.prototype.setToken=function(t,o){return void 0===o&&(o={}),{token:t,host:o.host||a.HOST,protocol:o.protocol||a.PROTOCOL,timeout:a.TIMEOUT,token_expiration:TOKEN_EXPIRES_IN,internal:!0}},y.prototype.prepareResources=function(){var t=this;for(var o in _)t[o[0].toLowerCase()+o.substring(1)]=new _[o](t.api)},y});
//# sourceMappingURL=index.js.map
