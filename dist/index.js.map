{"version":3,"file":"index.js","sources":["../lib/utils.js","../lib/urlHelpers.js","../lib/config.js","../lib/resource.js","../lib/resources/collections.js","../lib/resources/videos.js","../lib/resources/customers.js","../lib/resources/browse.js","../lib/vhx.js","../lib/resources/products.js","../lib/resources/analytics.js"],"sourcesContent":["export function getMethod(params) {\n  return isObject(params) && params.method ?\n          params.method :\n          params;\n}\n\nexport function isHref(params) {\n  return isNaN(parseInt(params, 10));\n}\n\nexport function isObject(obj) {\n  const type = typeof obj;\n  return type === 'function' || type === 'object' && !!obj;\n}\n\nexport function isFunction(obj) {\n  return !!(obj && obj.constructor && obj.call && obj.apply);\n}","import {\n  isHref,\n  isFunction\n} from './utils';\n\nexport function generateUrl(params, resource, options) {\n  if (resource.path === 'products') {\n    return createUrlWithStandardEndpoints(params, resource);\n  }\n\n  if (resource.path === 'videos') {\n    return createUrlWithCustomEndpoints(params, resource, options);\n  }\n\n  if (resource.path === 'collections') {\n    return createUrlWithCustomEndpoints(params, resource, options);\n  }\n\n  if (resource.path === 'customers') {\n    return createUrlWithCustomEndpoints(params, resource, options);\n  }\n\n  return returnDefaultHref(resource);\n};\n\nconst createUrlWithCustomEndpoints = (params, resource, options) => {\n  if (options && options.scope) {\n    if (isHref(params)) {\n      return `${params}/${options.scope}`;\n    }\n\n    return `${resource._api.protocol}${resource._api.host}/${resource.path}/${params}/${options.scope}`;\n  }\n\n  if (isHref(params) && !isFunction(params)) {\n    return params;\n  }\n\n  if (!isFunction(params)) {\n    return `${resource._api.protocol}${resource._api.host}/${resource.path}/${params}`;\n  }\n\n  return returnDefaultHref(resource);\n}\n\nconst returnDefaultHref = (resource) => {\n  return `${resource._api.protocol}${resource._api.host}/${resource.path}`;\n}\n\nconst createUrlWithStandardEndpoints = (params, resource) => {\n  if (isHref(params) && !isFunction(params)) {\n    return params;\n  }\n\n  if (!isFunction(params)) {\n    return `${resource._api.protocol}${resource._api.host}/${resource.path}/${params}`;\n  }\n\n  return returnDefaultHref(resource);\n}\n\n\n\n","const ApiConfig = {\n  HOST: 'api.vhx.tv',\n  PROTOCOL: 'https://',\n  TIMEOUT: '30000'\n};\n\nexport default ApiConfig;","import request from 'superagent';\nimport { generateUrl } from './urlHelpers';\nimport {\n  getMethod,\n  isObject,\n  isFunction,\n} from './utils';\n\nclass Resource {\n  constructor(api, path, methods, isToken) {\n    this._api    = api;\n    this.methods = methods;\n    this.path    = path;\n\n    this.init();\n  }\n\n  init() {\n    this.methods.forEach((item) => {\n      const method = getMethod(item);\n      const params = {\n        http_method: 'get', // superagent reads 'get' not 'GET'\n        client_method: method\n      };\n\n      if (method.match(/files|items|watching|watchlist/)) {\n        params.scope = item;\n      }\n\n      this[method] = (options, callback) => {\n        params.url = generateUrl(options, this, params);\n\n        if (isFunction(options)) {\n         params.callback = options;\n        } else {\n          params.callback = callback;\n        }\n\n        this.createRequestParams(params);\n      };\n    });\n  }\n\n  getParams(client_method, url, options, scope, type) {\n    const params = {\n      timeout : this._api.timeout,\n      method  : client_method,\n      url     : url,\n    };\n\n    if (isObject(options)) {\n      params.qs = options || null;\n    }\n\n    if (this._api.auth) {\n      params.headers = {\n        'Authorization': this._api.auth\n      };\n    }\n\n    if (this._api.internal) {\n      params.headers = {\n        'Authorization': 'Bearer ' + this._api.token\n      }\n    }\n\n    return params;\n  }\n\n  createRequestParams(args) {\n    const params = this.getParams(args.client_method, args.url, args.options, args.scope, args.read_only);\n\n    if (isFunction(args.options)) {\n      args.callback = args.options;\n    }\n\n    this.ajaxRequest(args, params);\n  }\n\n  ajaxRequest(args, params) {\n    request[args.http_method](params.url)\n      .withCredentials()\n      .set(params.headers || {})\n      .set('Content-Type', 'application/json')\n      .query(params.qs)\n      .end((err, response) => {\n        if (err) {\n          this.errorHandler({\n            status: response.statusCode,\n            body: JSON.stringify({\n              message: err,\n              documentation_url: \"http://dev.vhx.tv/docs/api\",\n            }),\n            callback: (args.callback || '')\n          });\n\n          return;\n        }\n\n        this.successHandler({\n          body: response.body || null,\n          callback: args.callback,\n          options: args.options,\n          object: this.path,\n          method: args.client_method\n        });\n      });\n  }\n\n  successHandler(args) {\n    const response = args.body;\n\n    // TODO: rebuild built-in pagination methods\n    // if (args.body.count && args.body.count < args.body.total) {\n    //   response = new paginate(this, args).get();\n    // }\n\n    response.object = args.object;\n\n    if (args.callback) {\n      args.callback(false, response);\n    }\n  }\n\n  errorHandler(args) {\n    // TODO: consider better error messaging\n    const error = JSON.parse(args.body);\n    const error_types = {\n      400: 'VHXInvalidRequestError',\n      401: 'VHXAuthenticationError',\n      404: 'VHXResourceNotFound',\n      408: 'VHXConnectionError',\n      500: 'VHXAPIError'\n    };\n\n    error.status = args.status;\n    error.type = error_types[error.status];\n\n    if (args.callback) {\n      args.callback(error, null);\n    }\n  }\n};\n\nexport default Resource;\n","import Resource from '../resource';\n\nclass Collection extends Resource {\n  constructor(api) {\n    super(api, 'collections', ['all', 'retrieve', 'items']);\n  }\n};\n\nexport default Collection;\n","import Resource from '../resource';\n\nclass Video extends Resource {\n  constructor(api) {\n    super(api, 'videos', ['all', 'retrieve', 'files']);\n  }\n};\n\nexport default Video;\n","import Resource from '../resource';\n\nclass Customer extends Resource {\n  constructor(api) {\n    super(api, 'customers', ['retrieve', 'all', 'watching', 'watchlist']);\n  }\n};\n\nexport default Customer;\n","import Resource from '../resource';\n\nclass Browse extends Resource {\n  constructor(api) {\n    super(api, 'browse', ['list']);\n  }\n};\n\nexport default Browse;\n","import ApiConfig from './config';\nimport Collection from './resources/collections';\nimport Video from './resources/videos';\nimport Customer from './resources/customers';\nimport Browse from './resources/browse';\nimport Product from './resources/products';\nimport Analytics from './resources/analytics';\n\nconst resources = {\n  products    : Product,\n  browse      : Browse,\n  videos      : Video,\n  collections : Collection,\n  customers   : Customer,\n  analytics   : Analytics\n};\n\nif (typeof btoa === 'undefined') {\n  global.btoa = function(str) {\n    return new Buffer(str).toString('base64');\n  }\n}\n\nclass VhxApi {\n  constructor(key, opts={}) {\n    this.api = opts.internal ? this.setToken(key, opts) : this.setApi(key, opts);\n\n    this.prepareResources();\n  }\n\n  setApi(key, opts = {}) {\n    return {\n      auth: 'Basic ' + btoa(key),\n      host: opts.host || ApiConfig.HOST,\n      protocol: opts.protocol || ApiConfig.PROTOCOL,\n      timeout: ApiConfig.TIMEOUT,\n      token_expiration: null\n    };\n  }\n\n  setToken(key, opts = {}) {\n    return {\n      token: key,\n      host: opts.host || ApiConfig.HOST,\n      protocol: opts.protocol || ApiConfig.PROTOCOL,\n      timeout: ApiConfig.TIMEOUT,\n      token_expiration: TOKEN_EXPIRES_IN,\n      internal: true\n    };\n  }\n\n  prepareResources() {\n    for (const name in resources) {\n      this[name[0].toLowerCase() + name.substring(1)] = new resources[name](this.api);\n    }\n  }\n}\n\nexport default VhxApi;","import Resource from '../resource';\n\nclass Product extends Resource {\n  constructor(api) {\n    super(api, 'products', ['retrieve', 'all']);\n  }\n};\n\nexport default Product;\n","import Resource from '../resource';\n\nclass Analytics extends Resource {\n  constructor(api) {\n    super(api, 'analytics', ['retrieve']);\n  }\n};\n\nexport default Analytics;\n"],"names":["getMethod","params","isObject","method","isHref","isNaN","parseInt","obj","const","type","isFunction","constructor","call","apply","generateUrl","resource","options","path","createUrlWithStandardEndpoints","createUrlWithCustomEndpoints","returnDefaultHref","ApiConfig","HOST","PROTOCOL","TIMEOUT","scope","_api","Resource","api","methods","isToken","this","init","forEach","item","http_method","client_method","match","this$1","callback","url","createRequestParams","getParams","timeout","qs","auth","headers","Authorization","internal","token","args","read_only","ajaxRequest","request","withCredentials","set","query","end","err","response","errorHandler","status","statusCode","body","JSON","stringify","message","documentation_url","successHandler","object","error","parse","error_types","400","401","404","408","500","Collection","super","Video","Customer","Browse","resources","products","browse","videos","collections","customers","analytics","btoa","global","str","Buffer","toString","VhxApi","key","opts","setToken","setApi","prepareResources","host","protocol","token_expiration","TOKEN_EXPIRES_IN","name","toLowerCase","substring"],"mappings":"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"}